(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[104],{63:(e,s,t)=>{"use strict";var r=t(7260);t.o(r,"useRouter")&&t.d(s,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(s,{useSearchParams:function(){return r.useSearchParams}})},449:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>o});var r=t(5155),n=t(2115),a=t(63);function i(){let e=(0,a.useRouter)(),s=(0,a.useSearchParams)(),[t,i]=(0,n.useState)([]),[o,c]=(0,n.useState)(!0),[l,u]=(0,n.useState)(!1),[d,m]=(0,n.useState)(!1),[h,x]=(0,n.useState)(""),g=s?s.get("ticketId"):null;(0,n.useEffect)(()=>{if(!g){console.warn("[UI][questions] missing ticketId, redirect"),e.replace("/guest/s/default");return}f()},[g,e]);let f=async()=>{console.log("[UI][questions] GET /api/questions");try{let e=await fetch("/api/questions");if(e.ok){let s=await e.json();console.log("[UI][questions] loaded",{count:s.length}),i(s)}}catch(e){console.error("[UI][questions] load error:",e)}finally{c(!1)}},p=(0,n.useCallback)(async()=>{l||(u(!0),setTimeout(()=>{e.replace("/merci")},2e3))},[l,e,g]),b=(0,n.useCallback)(async e=>{if(!l&&!d){m(!0),x("Envoi de la question...");try{console.log("[UI][submit] POST /api/submit",{questionId:e.id});let s=await fetch("/api/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({questionId:e.id,ticketId:g})});s.ok?(console.log("[UI][submit] success"),x("Question envoy\xe9e... Affichage en cours... R\xe9ponse envoy\xe9e !"),setTimeout(()=>{p()},1e3)):(console.error("[UI][submit] http error status=",s.status),x("Erreur lors de l'envoi"),m(!1))}catch(e){console.error("[UI][submit] network error:",e),x("Erreur de connexion"),m(!1)}}},[l,d,p,g]);return o?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-xl text-gray-600",children:"Chargement des questions..."})}):(0,r.jsx)("div",{className:"min-h-screen p-8",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-4 text-center",children:"Questions Techniques - 130 ans EMF"}),h&&(0,r.jsx)("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg text-center",children:(0,r.jsx)("p",{className:"text-blue-700 font-medium",children:h})}),(0,r.jsx)("div",{className:"space-y-4",children:t.map(e=>(0,r.jsxs)("div",{onClick:()=>b(e),className:"p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 hover:border-gray-300 transition-all ".concat(d||l?"opacity-50 cursor-not-allowed":""),children:[(0,r.jsx)("p",{className:"text-lg text-gray-700",children:e.question}),(0,r.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:["ID: ",e.id," • Cliquez pour envoyer \xe0 l'affichage"]})]},e.id))}),0===t.length&&(0,r.jsx)("div",{className:"text-center text-gray-500 mt-12",children:"Aucune question disponible pour le moment."}),(0,r.jsxs)("div",{className:"mt-8 text-center text-sm text-gray-500",children:[(0,r.jsx)("p",{children:"Version TEST - Simulation d'affichage via logs serveur"}),(0,r.jsx)("p",{children:"Questions charg\xe9es depuis JSON local • File d'attente en m\xe9moire"})]})]})})}function o(){return(0,r.jsx)(n.Suspense,{fallback:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-xl text-gray-600",children:"Chargement..."})}),children:(0,r.jsx)(i,{})})}},2393:(e,s,t)=>{Promise.resolve().then(t.bind(t,449))}},e=>{e.O(0,[441,255,358],()=>e(e.s=2393)),_N_E=e.O()}]);
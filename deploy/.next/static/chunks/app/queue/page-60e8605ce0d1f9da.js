(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[166],{63:(e,t,s)=>{"use strict";var r=s(7260);s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},6285:(e,t,s)=>{Promise.resolve().then(s.bind(s,9079))},9079:(e,t,s)=>{"use strict";s.d(t,{default:()=>o});var r=s(5155),n=s(2115),a=s(63);function l(){let e=(0,a.useRouter)(),t=(0,a.useSearchParams)(),[s,l]=(0,n.useState)(null),[o,i]=(0,n.useState)(!1),[u,c]=(0,n.useState)(null),[d,m]=(0,n.useState)(null),[x,h]=(0,n.useState)(null),p=t?t.get("ticketId"):null;(0,n.useEffect)(()=>{if(!p){console.warn("[UI][queue] missing ticketId in URL, redirect to /"),e.replace("/");return}let t=async()=>{console.log("[UI][queue][poll] GET /api/queue/status",{ticketId:p});try{let e=await fetch("/api/queue/status?ticketId=".concat(p));if(e.ok){let{position:t,activeTicketId:s}=await e.json();console.log("[UI][queue][poll] status=",{pos:t,active:s}),l(t),m(null!=s?s:null),0===t&&(console.warn("[UI][queue][poll] ticket inconnu/expir\xe9"),c("Ticket invalide ou expir\xe9"))}else console.error("[UI][queue][poll] http error status=",e.status),c("Erreur lors de la v\xe9rification de la position")}catch(e){console.error("[UI][queue][poll] network error:",e),c("Erreur de connexion")}};t();let s=setInterval(t,2e3);return()=>clearInterval(s)},[p,e]);let f=async()=>{if(p&&1===s){i(!0),console.log("[UI][queue][start] POST /api/queue/start",{ticketId:p});try{let t=await fetch("/api/queue/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ticketId:p})});if(t.ok){let s=await t.json();console.log("[UI][queue][start] result=",s),s.ok?(console.log("[UI][queue][start] navigate /questions",{ticketId:p}),e.push("/questions?ticketId=".concat(p))):"busy-active"===s.reason?h("Une session est en cours, veuillez patienter..."):"not-first"===s.reason?c("Vous n'\xeates plus le premier dans la file"):c("Impossible de d\xe9marrer")}else console.error("[UI][queue][start] http error status=",t.status),c("Erreur lors du d\xe9marrage de la session")}catch(e){console.error("[UI][queue][start] network error:",e),c("Erreur de connexion")}finally{i(!1)}}};return u?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center p-8",children:(0,r.jsxs)("div",{className:"max-w-md w-full text-center",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Erreur"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:u}),(0,r.jsx)("button",{onClick:()=>e.push("/"),className:"bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700",children:"Retour au d\xe9but"})]})}):(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center p-8",children:(0,r.jsxs)("div",{className:"max-w-md w-full text-center",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-8",children:"File d'attente"}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6 mb-6",children:[(0,r.jsx)("div",{className:"text-4xl font-bold text-blue-600 mb-2",children:null!==s?0===s?"❌":"".concat(s):"⏳"}),(0,r.jsxs)("p",{className:"text-gray-600",children:[null===s&&"V\xe9rification de votre position...",0===s&&"Ticket invalide",1===s&&(!d||d===p)&&"C'est votre tour !",1===s&&d&&d!==p&&"Une session est en cours, merci de patienter...",s&&s>1&&"".concat(s-1," personne(s) devant vous")]})]}),x&&(0,r.jsxs)("div",{className:"mb-4 flex items-center justify-center gap-2 text-blue-700",children:[(0,r.jsx)("span",{className:"inline-block h-3 w-3 rounded-full border-2 border-blue-300 border-t-transparent animate-spin"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:x})]}),1===s&&(!d||d===p)&&(0,r.jsx)("button",{onClick:f,disabled:o,className:"w-full bg-green-600 text-white py-3 px-4 rounded-md hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors text-lg font-medium",children:o?"D\xe9marrage...":"Commencer les questions"}),s&&s>1&&(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:[(0,r.jsx)("p",{children:"La page se mettra \xe0 jour automatiquement."}),(0,r.jsx)("p",{className:"mt-2",children:"Position rafra\xeechie toutes les 2 secondes."})]}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsx)("button",{onClick:()=>e.push("/guest/s/default"),className:"text-gray-500 hover:text-gray-700 text-sm",children:"← Retour au d\xe9but"})})]})})}function o(){return(0,r.jsx)(n.Suspense,{fallback:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-xl text-gray-600",children:"Chargement..."})}),children:(0,r.jsx)(l,{})})}}},e=>{e.O(0,[441,255,358],()=>e(e.s=6285)),_N_E=e.O()}]);
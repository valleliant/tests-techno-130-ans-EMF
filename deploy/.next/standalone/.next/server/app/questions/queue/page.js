(()=>{var e={};e.id=328,e.ids=[328],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7790:e=>{"use strict";e.exports=require("assert")},8893:e=>{"use strict";e.exports=require("buffer")},4770:e=>{"use strict";e.exports=require("crypto")},665:e=>{"use strict";e.exports=require("dns")},7702:e=>{"use strict";e.exports=require("events")},2048:e=>{"use strict";e.exports=require("fs")},8216:e=>{"use strict";e.exports=require("net")},9801:e=>{"use strict";e.exports=require("os")},5315:e=>{"use strict";e.exports=require("path")},6162:e=>{"use strict";e.exports=require("stream")},4026:e=>{"use strict";e.exports=require("string_decoder")},2452:e=>{"use strict";e.exports=require("tls")},4175:e=>{"use strict";e.exports=require("tty")},7360:e=>{"use strict";e.exports=require("url")},1764:e=>{"use strict";e.exports=require("util")},4557:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GlobalError:()=>o.a,__next_app__:()=>h,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d}),i(7808),i(2029),i(5866);var r=i(3191),s=i(8716),n=i(7922),o=i.n(n),a=i(5231),l={};for(let e in a)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>a[e]);i.d(t,l);let d=["",{children:["questions",{children:["queue",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(i.bind(i,7808)),"D:\\tests techno 130 ans EMF\\src\\app\\questions\\queue\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(i.bind(i,2029)),"D:\\tests techno 130 ans EMF\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(i.t.bind(i,5866,23)),"next/dist/client/components/not-found-error"]}],c=["D:\\tests techno 130 ans EMF\\src\\app\\questions\\queue\\page.tsx"],u="/questions/queue/page",h={require:i,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/questions/queue/page",pathname:"/questions/queue",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},2287:(e,t,i)=>{Promise.resolve().then(i.t.bind(i,2994,23)),Promise.resolve().then(i.t.bind(i,6114,23)),Promise.resolve().then(i.t.bind(i,9727,23)),Promise.resolve().then(i.t.bind(i,9671,23)),Promise.resolve().then(i.t.bind(i,1868,23)),Promise.resolve().then(i.t.bind(i,4759,23))},5303:()=>{},2029:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o,metadata:()=>s,viewport:()=>n});var r=i(9510);let s={title:"Portail captif EMF",description:"Questionnaire multilingue sans JavaScript client"},n={width:"device-width",initialScale:1};function o({children:e}){return r.jsx("html",{lang:"fr",children:r.jsx("body",{style:{margin:0,minHeight:"100vh",backgroundColor:"#f3f4f6",fontFamily:"Arial, sans-serif"},children:e})})}},7808:(e,t,i)=>{"use strict";let r,s;i.r(t),i.d(t,{default:()=>u});var n=i(9510);let o=require("node:crypto");var a=i(9534),l=i(2898);let d=`
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  .page {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
    background: #f3f4f6;
  }
  .card {
    background: #ffffff;
    border-radius: 12px;
    padding: 32px 28px;
    box-shadow: 0 8px 24px rgba(15, 23, 42, 0.08);
    width: 100%;
    max-width: 640px;
    text-align: center;
  }
  h1 {
    font-size: 24px;
    margin: 0 0 16px 0;
    color: #111827;
  }
  .question {
    font-size: 17px;
    color: #4b5563;
    margin-bottom: 16px;
  }
  .position {
    font-size: 22px;
    font-weight: 600;
    color: #2563eb;
    margin-bottom: 8px;
  }
  .time {
    font-size: 16px;
    color: #6b7280;
  }
  .info {
    margin-top: 16px;
    font-size: 14px;
    color: #6b7280;
  }
  button {
    margin-top: 20px;
    padding: 12px 18px;
    border: none;
    border-radius: 999px;
    background: #e5e7eb;
    color: #111827;
    cursor: pointer;
    font-size: 15px;
    transition: background-color 0.15s ease;
  }
  button:hover {
    background: #d1d5db;
  }
`,c={fr:{missing:"Identifiant utilisateur manquant. Merci de recommencer.",fallbackTitle:"File en pr\xe9paration",fallbackBody:"Redis n’est pas disponible pour le moment. Revenez plus tard.",queueTitle:"Votre question est en attente",refresh:"⟳ Cette page se rafra\xeechit automatiquement toutes les 5 secondes.",back:"← Retour au d\xe9but"},de:{missing:"Benutzer-ID fehlt. Bitte erneut starten.",fallbackTitle:"Warteschlange wird vorbereitet",fallbackBody:"Redis ist momentan nicht verf\xfcgbar. Bitte versuchen Sie es sp\xe4ter erneut.",queueTitle:"Ihre Frage wartet noch",refresh:"⟳ Diese Seite aktualisiert sich alle 5 Sekunden automatisch.",back:"← Zur\xfcck zum Start"}};async function u({searchParams:e}){let t=e.userId,i=e.lang,u=e.category,h=e.questionId,p=e.clientip,m=e.clientmac,x="de"===i?"de":"fr",f=c[x];if(!t&&i&&u&&h){let e="de"===i?"de":"fr"===i?"fr":void 0;if(e){let t=l[e]?.[u];if(t){let i=t.find(e=>e.id===h);if(i){let t=function(e=21){var t;t=e|=0,!r||r.length<t?(r=Buffer.allocUnsafe(128*t),o.webcrypto.getRandomValues(r),s=0):s+t>r.length&&(o.webcrypto.getRandomValues(r),s=0),s+=t;let i="";for(let t=s-e;t<s;t++)i+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&r[t]];return i}(10),l={id:h,question:i.question,lang:e,category:u,timestamp:new Date().toISOString(),userId:t};await (0,a.u0)(async()=>{if(!a.T8)throw Error("Redis client not initialized");return console.log("[REDIS] Attempting to add entry to queue (from list)..."),await a.T8.rpush("questions:queue",JSON.stringify(l)),console.log("[REDIS] Successfully added to queue (from list):",l),!0},!1,"RPUSH questions:queue (from list)"),console.log(`[QUEUE] Created entry from list - Lang: ${e}, Category: ${u}, QuestionId: ${h}, UserId: ${t}`);let c=new URLSearchParams({userId:t,lang:e});p&&c.append("clientip",p),m&&c.append("clientmac",m);let x=`/questions/queue?${c.toString()}`;return(0,n.jsxs)("html",{children:[(0,n.jsxs)("head",{children:[n.jsx("meta",{charSet:"utf-8"}),n.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),n.jsx("meta",{httpEquiv:"refresh",content:`0; url=${x}`}),n.jsx("title",{children:"Redirection file d'attente"}),n.jsx("style",{children:d})]}),n.jsx("body",{children:n.jsx("div",{className:"page",children:(0,n.jsxs)("div",{className:"card",children:[n.jsx("h1",{children:f.queueTitle}),n.jsx("p",{className:"question",children:"Pr\xe9paration de votre file d'attente…"})]})})})]})}console.error(`[QUEUE] Question not found on initial arrival: ${h}`)}else console.error(`[QUEUE] Invalid category on initial arrival: ${u} for lang: ${e}`)}else console.error("[QUEUE] Invalid lang on initial arrival:",i)}if(await (0,a.u0)(async()=>{if(!a.T8)throw Error("Redis client not initialized");let e=Date.now();for(let t=0;t<20;t+=1){let t=await a.T8.lindex("questions:queue",0);if(!t)break;let i=null;try{i=JSON.parse(t)}catch{await a.T8.lpop("questions:queue"),console.warn("[QUEUE] Removed invalid head entry during cleanup");continue}let r=Date.parse(i.timestamp),s=Number.isNaN(r)?0:e-r;if(s>=3e4)await a.T8.lpop("questions:queue"),console.log("[QUEUE] Auto-removed expired head from queue:",{userId:i.userId,id:i.id,ageMs:s});else break}return!0},!1,"QUEUE cleanup expired heads"),!t)return(0,n.jsxs)("html",{children:[(0,n.jsxs)("head",{children:[n.jsx("meta",{charSet:"utf-8"}),n.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),n.jsx("meta",{httpEquiv:"refresh",content:"5"}),n.jsx("title",{children:"File d'attente"}),n.jsx("style",{children:d})]}),n.jsx("body",{children:n.jsx("div",{className:"page",children:(0,n.jsxs)("div",{className:"card",children:[n.jsx("h1",{children:f.fallbackTitle}),n.jsx("p",{className:"question",children:f.missing}),n.jsx("form",{method:"GET",action:"/questions",children:n.jsx("button",{type:"submit",children:f.back})})]})})})]});let g=(await (0,a.u0)(async()=>{if(!a.T8)throw Error("Redis client not initialized");return a.T8.lrange("questions:queue",0,-1)},[],"LRANGE questions:queue")).map(e=>{try{return JSON.parse(e)}catch{return null}}).filter(e=>!!e);if(!a.jJ||0===g.length)return console.warn("[QUEUE] Redis unavailable or queue empty"),(0,n.jsxs)("html",{children:[(0,n.jsxs)("head",{children:[n.jsx("meta",{charSet:"utf-8"}),n.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),n.jsx("meta",{httpEquiv:"refresh",content:"5"}),n.jsx("title",{children:"File d'attente"}),n.jsx("style",{children:d})]}),n.jsx("body",{children:n.jsx("div",{className:"page",children:(0,n.jsxs)("div",{className:"card",children:[n.jsx("h1",{children:f.fallbackTitle}),n.jsx("p",{className:"question",children:f.fallbackBody}),n.jsx("form",{method:"GET",action:"/questions",children:n.jsx("button",{type:"submit",children:f.back})})]})})})]});let q=g.findIndex(e=>e.userId===t)+1,j=g.length,v=g.find(e=>e.userId===t);if(console.log(`[QUEUE] UserId: ${t}, Queue length: ${g.length}`),!v||0===q)return console.warn("[QUEUE] Entry not found for userId",t),(0,n.jsxs)("html",{children:[(0,n.jsxs)("head",{children:[n.jsx("meta",{charSet:"utf-8"}),n.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),n.jsx("meta",{httpEquiv:"refresh",content:"5"}),n.jsx("title",{children:"File d'attente"}),n.jsx("style",{children:d})]}),n.jsx("body",{children:n.jsx("div",{className:"page",children:(0,n.jsxs)("div",{className:"card",children:[n.jsx("h1",{children:f.fallbackTitle}),n.jsx("p",{className:"question",children:f.missing}),n.jsx("form",{method:"GET",action:"/questions",children:n.jsx("button",{type:"submit",children:f.back})})]})})})]});let b=30*q;if(console.log(`[QUEUE] Position: ${q}/${j}, Estimated time: ${b}s`),1===q){console.log(`[QUEUE] User ${t} reached position 1 - redirecting`);let e=new URLSearchParams({userId:t,lang:x});p&&e.append("clientip",p),m&&e.append("clientmac",m);let i=e.toString(),r=`/questions/display?${i}`;return console.log("[QUEUE] Redirecting to display:",r),(0,n.jsxs)("html",{children:[(0,n.jsxs)("head",{children:[n.jsx("meta",{charSet:"utf-8"}),n.jsx("meta",{httpEquiv:"refresh",content:`0; url=${r}`}),n.jsx("title",{children:"C'est votre tour"}),n.jsx("style",{children:d})]}),n.jsx("body",{children:n.jsx("div",{className:"page",children:(0,n.jsxs)("div",{className:"card",children:[n.jsx("h1",{children:"\uD83C\uDF89 C'est votre tour !"}),n.jsx("p",{className:"question",children:"Redirection..."})]})})})]})}return(0,n.jsxs)("html",{children:[(0,n.jsxs)("head",{children:[n.jsx("meta",{charSet:"utf-8"}),n.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),n.jsx("meta",{httpEquiv:"refresh",content:"5"}),n.jsx("title",{children:"File d'attente"}),n.jsx("style",{children:d})]}),n.jsx("body",{children:n.jsx("div",{className:"page",children:(0,n.jsxs)("div",{className:"card",children:[n.jsx("h1",{children:f.queueTitle}),(0,n.jsxs)("p",{className:"question",children:["\xab ",v.question," \xbb"]}),(0,n.jsxs)("div",{className:"position",children:[q," / ",j]}),(0,n.jsxs)("div",{className:"time",children:["Temps estim\xe9 : ~",Math.floor(b/60)," min ",b%60," sec"]}),n.jsx("div",{className:"info",children:f.refresh})]})})})]})}},9534:(e,t,i)=>{"use strict";i.d(t,{T8:()=>s,jJ:()=>n,u0:()=>o});var r=i(2197);let s=null,n=!1;try{(s=new r.Redis({host:process.env.REDIS_HOST||"localhost",port:parseInt(process.env.REDIS_PORT||"6379",10),retryStrategy:e=>e>3?(console.error("[REDIS] Max retry attempts reached. Redis unavailable."),null):Math.min(50*e,2e3),maxRetriesPerRequest:3})).on("connect",()=>{console.log("[REDIS] Connected successfully"),n=!0}),s.on("error",e=>{console.error("[REDIS ERROR]",e.message),n=!1})}catch(e){console.error("[REDIS] Failed to initialize:",e),s=null,n=!1}async function o(e,t,i){if(!s)return console.warn(`[REDIS FALLBACK] ${i} - Redis client not initialized, using fallback`),t;try{return await e()}catch(e){return console.error(`[REDIS ERROR] ${i} failed:`,e),t}}},2898:e=>{"use strict";e.exports=JSON.parse('{"fr":{"technologie":[{"id":"1","question":"Quel est votre langage de programmation pr\xe9f\xe9r\xe9 ?"},{"id":"2","question":"Pr\xe9f\xe9rez-vous iOS ou Android ?"},{"id":"3","question":"Quel est votre \xe9diteur de code favori ?"}],"loisirs":[{"id":"4","question":"Quel est votre film pr\xe9f\xe9r\xe9 ?"},{"id":"5","question":"Quel sport pratiquez-vous ?"},{"id":"6","question":"Quel est votre livre pr\xe9f\xe9r\xe9 ?"}],"general":[{"id":"7","question":"Quelle est votre couleur pr\xe9f\xe9r\xe9e ?"},{"id":"8","question":"Caf\xe9 ou th\xe9 ?"}]},"de":{"technologie":[{"id":"9","question":"Was ist Ihre bevorzugte Programmiersprache?"},{"id":"10","question":"Bevorzugen Sie iOS oder Android?"},{"id":"11","question":"Was ist Ihr bevorzugter Code-Editor?"}],"freizeit":[{"id":"12","question":"Was ist Ihr Lieblingsfilm?"},{"id":"13","question":"Welchen Sport treiben Sie?"},{"id":"14","question":"Was ist Ihr Lieblingsbuch?"}],"allgemein":[{"id":"15","question":"Was ist Ihre Lieblingsfarbe?"},{"id":"16","question":"Kaffee oder Tee?"}]}}')}};var t=require("../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),r=t.X(0,[276,471,197],()=>i(4557));module.exports=r})();